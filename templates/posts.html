{% extends "base.html" %}

{% block title %}{{ category|title }} - GetCareer24{% endblock %}

{% block content %}
<div class="container">
    <div class="section-header">
        <h1>{{ category|title }}</h1>
        <p>Browse all {{ category }} opportunities</p>
    </div>

    <div class="posts-list">
        {% for post in posts %}
        <div class="post-item">
            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="post-item-link">
                <div class="post-content">
                    <div class="post-header">
                        <div class="post-category {{ post.category }}">{{ post.category|title }}</div>
                        <h2>{{ post.title }}</h2>
                    </div>
                    <p class="post-description">{{ post.description }}</p>
                    <div class="post-details">
                        {% if post.company %}
                        <span class="detail-item"><i class="fas fa-building"></i> {{ post.company }}</span>
                        {% endif %}
                        {% if post.location %}
                        <span class="detail-item"><i class="fas fa-map-marker-alt"></i> {{ post.location }}</span>
                        {% endif %}
                        <span class="detail-item"><i class="fas fa-calendar"></i> {{ post.date }}</span>
                        {% if post.exam_date %}
                        <span class="detail-item exam-highlight"><i class="fas fa-calendar-day"></i> {{ post.exam_date }}</span>
                        {% endif %}
                    </div>
                </div>
            </a>
            <!-- Share button positioned absolutely -->
            <div class="share-dropdown">
                <button class="share-btn" onclick="toggleShareDropdown(this)">
                    <i class="fas fa-share-alt"></i>
                </button>
                <div class="share-dropdown-content">
                    <button onclick="copyPostLink('{{ url_for('post_detail', post_id=post.id) }}', this)">
                        <i class="fas fa-link"></i> Copy Link
                    </button>
                    <a href="https://wa.me/?text=Check out this opportunity: {{ post.title }} - {{ url_for('post_detail', post_id=post.id, _external=True) }}" target="_blank" onclick="event.stopPropagation()">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this opportunity: {{ post.title }}&url={{ url_for('post_detail', post_id=post.id, _external=True) }}" target="_blank" onclick="event.stopPropagation()">
                        <i class="fab fa-twitter"></i> Twitter
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ url_for('post_detail', post_id=post.id, _external=True) }}" target="_blank" onclick="event.stopPropagation()">
                        <i class="fab fa-facebook"></i> Facebook
                    </a>
                    <a href="mailto:?subject=Check this opportunity: {{ post.title }}&body=Check out this opportunity: {{ post.title }} - {{ url_for('post_detail', post_id=post.id, _external=True) }}" onclick="event.stopPropagation()">
                        <i class="fas fa-envelope"></i> Email
                    </a>
                </div>
            </div>
        </div>
        {% else %}
        <div class="no-posts">
            <i class="fas fa-inbox"></i>
            <h3>No {{ category }} opportunities available at the moment</h3>
            <p>Please check back later for new postings.</p>
        </div>
        {% endfor %}
    </div>
</div>



<script>
    function toggleShareDropdown(button) {
        event.preventDefault();
        event.stopPropagation();

        const dropdown = button.nextElementSibling;
        const allDropdowns = document.querySelectorAll('.share-dropdown-content');

        // Close all other dropdowns
        allDropdowns.forEach(drop => {
            if (drop !== dropdown) {
                drop.classList.remove('show-dropdown');
            }
        });

        // Toggle current dropdown
        dropdown.classList.toggle('show-dropdown');
    }

    function copyPostLink(url, button) {
        event.preventDefault();
        event.stopPropagation();

        const fullUrl = window.location.origin + url;
        navigator.clipboard.writeText(fullUrl).then(() => {
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
                button.innerHTML = originalText;
                // Close dropdown after copy
                const dropdown = button.closest('.share-dropdown-content');
                if (dropdown) {
                    dropdown.classList.remove('show-dropdown');
                }
            }, 1500);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = fullUrl;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 1500);
        });
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
        // Check if click is outside any share dropdown
        if (!event.target.closest('.share-dropdown')) {
            document.querySelectorAll('.share-dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('show-dropdown');
            });
        }
    });

    // Close dropdown when pressing Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            document.querySelectorAll('.share-dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('show-dropdown');
            });
        }
    });
</script>
{% endblock %}
